ERROR:root:An error occurred:
Traceback (most recent call last):
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/pytorch_lightning/trainer/call.py", line 46, in _call_and_handle_interrupt
    return trainer.strategy.launcher.launch(trainer_fn, *args, trainer=trainer, **kwargs)
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/pytorch_lightning/strategies/launchers/subprocess_script.py", line 105, in launch
    return function(*args, **kwargs)
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/pytorch_lightning/trainer/trainer.py", line 574, in _fit_impl
    self._run(model, ckpt_path=ckpt_path)
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/pytorch_lightning/trainer/trainer.py", line 981, in _run
    results = self._run_stage()
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/pytorch_lightning/trainer/trainer.py", line 1025, in _run_stage
    self.fit_loop.run()
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/pytorch_lightning/loops/fit_loop.py", line 205, in run
    self.advance()
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/pytorch_lightning/loops/fit_loop.py", line 363, in advance
    self.epoch_loop.run(self._data_fetcher)
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/pytorch_lightning/loops/training_epoch_loop.py", line 141, in run
    self.on_advance_end(data_fetcher)
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/pytorch_lightning/loops/training_epoch_loop.py", line 295, in on_advance_end
    self.val_loop.run()
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/pytorch_lightning/loops/utilities.py", line 178, in _decorator
    return loop_run(self, *args, **kwargs)
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/pytorch_lightning/loops/evaluation_loop.py", line 135, in run
    self._evaluation_step(batch, batch_idx, dataloader_idx, dataloader_iter)
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/pytorch_lightning/loops/evaluation_loop.py", line 396, in _evaluation_step
    output = call._call_strategy_hook(trainer, hook_name, *step_args)
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/pytorch_lightning/trainer/call.py", line 319, in _call_strategy_hook
    output = fn(*args, **kwargs)
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/pytorch_lightning/strategies/strategy.py", line 410, in validation_step
    return self._forward_redirection(self.model, self.lightning_module, "validation_step", *args, **kwargs)
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/pytorch_lightning/strategies/strategy.py", line 640, in __call__
    wrapper_output = wrapper_module(*args, **kwargs)
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1553, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1562, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/torch/nn/parallel/distributed.py", line 1636, in forward
    else self._run_ddp_forward(*inputs, **kwargs)
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/torch/nn/parallel/distributed.py", line 1454, in _run_ddp_forward
    return self.module(*inputs, **kwargs)  # type: ignore[index]
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1553, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1562, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/pytorch_lightning/strategies/strategy.py", line 633, in wrapped_forward
    out = method(*_args, **_kwargs)
  File "/home/ec2-user/workspace/cf_rank/engine.py", line 274, in validation_step
    acc = get_ndcg(logits.detach().cpu(), labels.detach().cpu(), return_dcg=self.args.use_dcg)
  File "/home/ec2-user/workspace/cf_rank/src/utils.py", line 386, in get_ndcg
    score = rax.dcg_metric(preds, targets, topn=k)
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1553, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 1562, in _call_impl
    return forward_call(*args, **kwargs)
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/torchmetrics/metric.py", line 312, in forward
    self._forward_cache = self._forward_reduce_state_update(*args, **kwargs)
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/torchmetrics/metric.py", line 382, in _forward_reduce_state_update
    batch_val = self.compute()
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/torchmetrics/metric.py", line 633, in wrapped_func
    value = _squeeze_if_scalar(compute(*args, **kwargs))
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/torchmetrics/retrieval/base.py", line 178, in compute
    res.append(self._metric(mini_preds, mini_target))
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/torchmetrics/retrieval/ndcg.py", line 121, in _metric
    return retrieval_normalized_dcg(preds, target, top_k=self.top_k, return_dcg=self.return_dcg)
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/torchmetrics/functional/retrieval/ndcg.py", line 112, in retrieval_normalized_dcg
    gain[~all_irrelevant] /= normalized_gain[~all_irrelevant]
KeyboardInterrupt

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "/home/ec2-user/workspace/cf_rank/main.py", line 226, in <module>
    logging.basicConfig(filename=args.output_dir+'/error.log', level=logging.ERROR)
  File "/home/ec2-user/workspace/cf_rank/main.py", line 192, in main
    trainer.resume(load_path=args.load_path, model='reward')
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/pytorch_lightning/trainer/trainer.py", line 538, in fit
    call._call_and_handle_interrupt(
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/pytorch_lightning/trainer/call.py", line 60, in _call_and_handle_interrupt
    trainer._teardown()
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/pytorch_lightning/trainer/trainer.py", line 1004, in _teardown
    self.strategy.teardown()
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/pytorch_lightning/strategies/ddp.py", line 419, in teardown
    super().teardown()
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/pytorch_lightning/strategies/parallel.py", line 133, in teardown
    super().teardown()
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/pytorch_lightning/strategies/strategy.py", line 535, in teardown
    self.lightning_module.cpu()
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/lightning_fabric/utilities/device_dtype_mixin.py", line 82, in cpu
    return super().cpu()
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 965, in cpu
    return self._apply(lambda t: t.cpu())
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 780, in _apply
    module._apply(fn)
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 780, in _apply
    module._apply(fn)
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 780, in _apply
    module._apply(fn)
  [Previous line repeated 4 more times]
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 805, in _apply
    param_applied = fn(param)
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/torch/nn/modules/module.py", line 965, in <lambda>
    return self._apply(lambda t: t.cpu())
  File "/home/ec2-user/anaconda3/envs/rank3/lib/python3.9/site-packages/torch/utils/data/_utils/signal_handling.py", line 67, in handler
    _error_if_any_worker_fails()
RuntimeError: DataLoader worker (pid 48661) exited unexpectedly with exit code 1. Details are lost due to multiprocessing. Rerunning with num_workers=0 may give better error trace.
